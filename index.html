<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <title>Ojo 3D</title>
  <script type="module" src="https://unpkg.com/@google/model-viewer/dist/model-viewer.min.js"></script>
  <style>
    body { margin: 0; background: #000; }
    model-viewer { width: 100%; height: 100vh; }
  </style>
</head>
<body>
  <model-viewer 
       id="visor"
       src="Ojo_nuevo.glb" 
       auto-rotate 
       camera-controls 
       alt="Ojo 3D">
  </model-viewer>

  <script>
    // Equivalencias exactas con nombres del modelo
    const equivalencias = {
      "A1 Cristalino": "A1 Cristalino",
      "A2 Glaucoma": "A2 Glaucoma",
      "A3 Córnea": "A3 Córnea",
      "A4 Combinadas": "A4 Combinadas",
      "A5 Iris": "A5 Iris",
      "A6 Conjuntiva": "A6 Conjuntiva",
      "B1 Vitrectomía": "B1 Vitrectomía",
      "B2 Esclera": "B2 Esclera",
      "B4 Vía Intravitrea": "B4 Vía Intravitrea",
      "C. Oculo-plástica": "C. Oculo-plástica",
      "D. Refractiva Corneal Laser": "D. Refractiva Corneal Laser",
      "E. Estrabismo": "E. Estrabismo",
      "H. OculoEstética": "H. OculoEstética"
    };

    const urlParams = new URLSearchParams(window.location.search);
    let clase = urlParams.get('clase');
    const viewer = document.querySelector('#visor');

    viewer.addEventListener('load', () => {
      const model = viewer.model;
      if (!model) {
        console.warn("No se pudo acceder al modelo");
        return;
      }

      // Si no se seleccionó nada o es "todo", dejamos el ojo en gris
      if (!clase || clase.toLowerCase().includes("todo")) {
        model.scene.traverse((obj) => {
          if (obj.material) {
            obj.material.color.setRGB(0.7, 0.7, 0.7); // gris claro
            obj.material.emissive.setRGB(0, 0, 0);
            obj.material.transparent = false;
          }
        });
        return;
      }

      clase = clase.trim();
      const nombreReal = equivalencias[clase] || clase;

      let nodoSeleccionado = null;

      // 1) Poner todo el ojo en gris por defecto
      model.scene.traverse((obj) => {
        if (obj.material) {
          obj.material.color.setRGB(0.4, 0.4, 0.4); // gris oscuro
          obj.material.emissive.setRGB(0, 0, 0);
          obj.material.transparent = false;
        }
        if (obj.name === nombreReal) {
          nodoSeleccionado = obj;
        }
      });

      // 2) Resaltar la parte seleccionada
      if (nodoSeleccionado && nodoSeleccionado.material) {
        nodoSeleccionado.material.color.setRGB(1, 1, 0); // Amarillo brillante
        nodoSeleccionado.material.emissive.setRGB(1, 1, 0);
      } else {
        console.warn(`No se encontró la parte "${nombreReal}"`);
      }
    });
  </script>
</body>
</html>
