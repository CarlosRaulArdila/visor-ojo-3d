<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <title>Ojo 3D</title>
  <!-- Librería de Google para Model Viewer -->
  <script type="module" src="https://unpkg.com/@google/model-viewer/dist/model-viewer.min.js"></script>
  <style>
    body { margin: 0; background: #000; }
    model-viewer { width: 100%; height: 100vh; }
  </style>
</head>
<body>
  <!-- El visor -->
  <model-viewer 
       id="visor"
       src="Ojo_nuevo.glb" 
       auto-rotate 
       camera-controls 
       alt="Ojo 3D">
  </model-viewer>

  <script>
    // Mapa de equivalencias: nombres en la tabla -> nombres reales en el modelo
    const equivalencias = {
      "A1 Cristalino": "Cristalino",
      "A2 Glaucoma": "Glaucoma",
      "A3 Córnea": "Cornea",
      "A4 Combinadas": "Combinadas",
      "A5 Iris": "Iris",
      "A6 Conjuntiva": "Conjuntiva"
    };

    // Capturamos el parámetro ?clase= de la URL
    const urlParams = new URLSearchParams(window.location.search);
    let clase = urlParams.get('clase');

    const viewer = document.querySelector('#visor');

    // Esperar que el modelo se cargue
    viewer.addEventListener('load', async () => {
      if (clase) {
        clase = clase.trim();
        const nombreReal = equivalencias[clase] || clase;

        // Accedemos al modelo cargado
        const root = viewer.model;
        if (!root) {
          console.warn("El modelo no está cargado aún");
          return;
        }

        // Buscar el nodo por nombre
        const nodo = root.getNodeByName(nombreReal);

        if (nodo && nodo.mesh) {
          // Cambiar color de la pieza seleccionada
          nodo.mesh.material.emissiveFactor = [1, 0, 0]; // rojo brillante

          // Atenuar las demás piezas
          root.traverse((n) => {
            if (n.mesh && n !== nodo) {
              n.mesh.material.pbrMetallicRoughness.setBaseColorFactor([0.5, 0.5, 0.5, 0.3]);
            }
          });
        } else {
          console.warn(`No se encontró la parte "${nombreReal}" en el modelo 3D.`);
        }
      }
    });
  </script>
</body>
</html>
