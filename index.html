<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <title>Ojo 3D</title>
  <script type="module" src="https://unpkg.com/@google/model-viewer/dist/model-viewer.min.js"></script>
  <style>
    body { margin: 0; background: #000; }
    model-viewer { width: 100%; height: 100vh; }
  </style>
</head>
<body>
  <model-viewer 
       id="visor"
       src="Ojo_nuevo.glb" 
       auto-rotate 
       camera-controls 
       alt="Ojo 3D">
  </model-viewer>

  <script>
    // Función para normalizar texto (quita acentos, espacios y pone minúsculas)
    function normalizar(texto) {
      return texto
        .normalize("NFD")
        .replace(/[\u0300-\u036f]/g, "")
        .replace(/\s+/g, "")
        .toLowerCase();
    }

    const urlParams = new URLSearchParams(window.location.search);
    let clase = urlParams.get('clase');
    const viewer = document.querySelector('#visor');

    viewer.addEventListener('load', () => {
      const graph = viewer.sceneGraph;
      if (!graph) {
        console.warn("No se pudo acceder al sceneGraph");
        return;
      }

      // Mostrar todos los nombres del modelo en consola (debug)
      console.log("----- LISTA DE NOMBRES EN EL MODELO -----");
      graph.traverse((n) => {
        if (n.name) console.log(n.name);
      });
      console.log("-----------------------------------------");

      // Si no hay clase o es "todo", ojo completo gris claro
      if (!clase || clase.toLowerCase().includes("todo")) {
        graph.traverse((n) => {
          if (n.material && n.material.pbrMetallicRoughness) {
            n.material.pbrMetallicRoughness.setBaseColorFactor([0.7, 0.7, 0.7, 1]); // gris claro
          }
        });
        return;
      }

      // Normalizar clase
      clase = normalizar(clase);

      let nodoSeleccionado = null;

      // Poner todo gris oscuro y buscar el nodo que coincida
      graph.traverse((n) => {
        if (n.material && n.material.pbrMetallicRoughness) {
          n.material.pbrMetallicRoughness.setBaseColorFactor([0.3, 0.3, 0.3, 1]); // gris oscuro
        }
        // Comparación flexible
        if (n.name && normalizar(n.name).includes(clase)) {
          nodoSeleccionado = n;
        }
      });

      // Resaltar el nodo
      if (nodoSeleccionado && nodoSeleccionado.material && nodoSeleccionado.material.pbrMetallicRoughness) {
        nodoSeleccionado.material.pbrMetallicRoughness.setBaseColorFactor([1, 1, 0, 1]); // amarillo
      } else {
        console.warn(`No se encontró la parte que coincide con "${clase}"`);
      }
    });
  </script>
</body>
</html>
